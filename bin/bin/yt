#!/usr/bin/env bash

# Check if URL argument is provided
if [ -z "$1" ]; then
    echo "Error: URL argument is missing"
    echo "Usage: $0 <YouTube URL>"
    exit 1
fi

# Use the first argument as the URL
URL="$1"

# Download subtitles and process them
yt-dlp --skip-download --write-subs --write-auto-subs --sub-lang en --sub-format ttml --convert-subs srt --output "transcript.%(ext)s" "$URL" && \
sed -i '' -e '/^[0-9][0-9]:[0-9][0-9]:[0-9][0-9].[0-9][0-9][0-9] --> [0-9][0-9]:[0-9][0-9]:[0-9][0-9].[0-9][0-9][0-9]$/d' \
         -e '/^[[:digit:]]\{1,3\}$/d' \
         -e 's/<[^>]*>//g' ./transcript.en.srt && \
sed -e 's/<[^>]*>//g' -e '/^[[:space:]]*$/d' transcript.en.srt | nvim - && \
rm transcript.en.srt
